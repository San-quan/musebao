# .github/workflows/subconverter-update.yml
name: Subconverter Auto Update

on:
  schedule:
    - cron: '0 19 * * *'  # åŒ—äº¬æ—¶é—´å‡Œæ™¨3ç‚¹ (UTC+8)
  workflow_dispatch:       # æ‰‹åŠ¨è§¦å‘

jobs:
  check-and-update:
    runs-on: ubuntu-latest
    steps:
      - name: Check version and update
        run: |
          # æ£€æŸ¥ç‰ˆæœ¬
          CURRENT_VER=$(curl -s "http://47.243.27.69:25500/version" | grep -oP 'subconverter v\K[^\s]+' || echo "unknown")
          LATEST_VER=$(curl -s "https://api.github.com/repos/tindy2013/subconverter/releases/latest" | jq -r .tag_name | sed 's/v//')
          
          echo "Current: $CURRENT_VER, Latest: $LATEST_VER"
          
          if [ "$CURRENT_VER" != "$LATEST_VER" ]; then
            echo "Update required!"
            # è¿™é‡Œå¯ä»¥å‘é€é€šçŸ¥æˆ–è°ƒç”¨æ›´æ–°API
            curl -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
              -d "chat_id=${{ secrets.TG_CHAT_ID }}&text=ğŸš€ Subconverteræ›´æ–°å¯ç”¨: $CURRENT_VER â†’ $LATEST_VER"
          else
            echo "Already up to date!"
          fi
